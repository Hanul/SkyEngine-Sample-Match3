SkyEngine.Delay=CLASS(e=>{let n=[];e.step=(e=>{n.forEach(n=>{n.step(e)})});return{init:(e,t,i,o)=>{void 0===o&&(o=i,i=0);let c=0,a=(t.resume=RAR(()=>{CHECK_IS_IN({array:n,value:t})!==!0&&n.push(t)}),t.pause=(()=>{REMOVE({array:n,value:t})})),r=t.remove=(()=>{a()});t.step=(e=>{c+=e,c>=i&&(o(),r())})}}}),SkyEngine.E=CLASS({preset:()=>{return E},init:(e,n,t)=>{n.stopDefault=(()=>{t.stopDefault()}),n.stopBubbling=(()=>{t.stopBubbling()}),n.checkIsBubblingStoped=(()=>{return t.checkIsBubblingStoped()}),n.stop=(()=>{t.stop()}),n.getX=(()=>{return t.getLeft()-SkyEngine.Screen.getWidth()/2}),n.getY=(()=>{return t.getTop()-SkyEngine.Screen.getHeight()/2}),n.getKey=(()=>{return t.getKey()}),n.getWheelDelta=(()=>{return t.getWheelDelta()})}}),SkyEngine.Interval=CLASS(e=>{let n=[];e.step=(e=>{n.forEach(n=>{n.step(e)})});return{init:(e,t,i,o)=>{void 0===o&&(o=i,i=0);let c=0,a=0,r=(t.resume=RAR(()=>{CHECK_IS_IN({array:n,value:t})!==!0&&n.push(t)}),t.pause=(()=>{REMOVE({array:n,value:t})})),l=t.remove=(()=>{r()});t.step=(e=>{c+=e,c>=i&&(c-=i,a+=1,o(t,a)===!1&&l())})}}}),SkyEngine.Node=CLASS({init:(e,n,t)=>{let i,o,c,a,r,l,g,d,u,f,S,s,v,h,R,p,E,y,k,m,C,w,Y,D,X,I,x,A,T,P,M,O,H,L,V,F,N,W,b,_,U,B,K,G,q,z,Z,J,j,Q,$,ee,ne,te,ie,oe,ce,ae,re,le,ge,de,ue,fe,Se=[],se=!1,ve=!1,he={},Re=[],pe=[],Ee=[],ye={},ke={},me={},Ce=()=>{if(void 0===ce)_=i,U=o,B=i,K=o;else{let e=i*ce.getRealScaleX(),n=o*ce.getRealScaleY();_=ce.getDrawingX()+e*ce.getRealCos()-n*ce.getRealSin(),U=ce.getDrawingY()+e*ce.getRealSin()+n*ce.getRealCos();let t=a*G,c=r*q;B=_-t*J+c*Z,K=U-t*Z-c*J}},we=(n.setX=(e=>{i=e,Ce()}),n.getX=(()=>{return i}),n.setY=(e=>{o=e,Ce()}),n.getY=(()=>{return o}),n.setZIndex=(e=>{void 0!==oe&&(We(),c=e,Ne())})),Ye=(n.getZIndex=(()=>{return c}),n.setPosition=(e=>{void 0!==e.x&&(i=e.x),void 0!==e.y&&(o=e.y),void 0===e.x&&void 0===e.y||Ce(),void 0!==e.zIndex&&we(e.zIndex)}),n.setCenterX=(e=>{a=e}),n.getCenterX=(()=>{return a}),n.setCenterY=(e=>{r=e}),n.getCenterY=(()=>{return r}),n.setSpeedX=(e=>{f=e}),n.getSpeedX=(()=>{return f}),n.setSpeedY=(e=>{S=e}),n.getSpeedY=(()=>{return S}),n.setAccelX=(e=>{p=e}),n.getAccelX=(()=>{return p}),n.setAccelY=(e=>{E=e}),n.getAccelY=(()=>{return E}),n.setMinSpeedX=(e=>{w=e}),n.getMinSpeedX=(()=>{return w}),n.setMinSpeedY=(e=>{Y=e}),n.getMinSpeedY=(()=>{return Y}),n.setMaxSpeedX=(e=>{A=e}),n.getMaxSpeedX=(()=>{return A}),n.setMaxSpeedY=(e=>{T=e}),n.getMaxSpeedY=(()=>{return T}),n.setToX=(e=>{L=e}),n.getToX=(()=>{return L}),n.setToY=(e=>{V=e}),n.getToY=(()=>{return V}),n.setScaleX=(e=>{l=e,G=void 0===ce?l:ce.getRealScaleX()*l})),De=(n.getScaleX=(()=>{return l}),n.setScaleY=(e=>{g=e,q=void 0===ce?e:ce.getRealScaleY()*g})),Xe=(n.getScaleY=(()=>{return g}),n.setScale=(e=>{Ye(e),De(e)})),Ie=(n.setScalingSpeedX=(e=>{s=e}),n.getScalingSpeedX=(()=>{return s}),n.setScalingSpeedY=(e=>{v=e}),n.getScalingSpeedY=(()=>{return v}),n.setScalingSpeed=(e=>{s=e,v=e})),xe=(n.setScalingAccelX=(e=>{y=e}),n.getScalingAccelX=(()=>{return y}),n.setScalingAccelY=(e=>{k=e}),n.getScalingAccelY=(()=>{return k}),n.setScalingAccel=(e=>{y=e,k=e})),Ae=(n.setMinScalingSpeedX=(e=>{D=e}),n.getMinScalingSpeedX=(()=>{return D}),n.setMinScalingSpeedY=(e=>{X=e}),n.getMinScalingSpeedY=(()=>{return X}),n.setMinScalingSpeed=(e=>{D=e,X=e}),n.setMaxScalingSpeedX=(e=>{P=e}),n.getMaxScalingSpeedX=(()=>{return P}),n.setMaxScalingSpeedY=(e=>{M=e}),n.getMaxScalingSpeedY=(()=>{return M}),n.setMaxScalingSpeed=(e=>{P=e,M=e}),n.setToScaleX=(e=>{F=e}),n.getToScaleX=(()=>{return F}),n.setToScaleY=(e=>{N=e}),n.getToScaleY=(()=>{return N}),n.setToScale=(e=>{F=e,N=e})),Te=n.setAngle=(e=>{d=e,z=void 0===ce?d*Math.PI/180:ce.getRealRadian()+d*Math.PI/180,Z=Math.sin(z),J=Math.cos(z)}),Pe=(n.getAngle=(()=>{return d}),n.setRotationSpeed=(e=>{h=e}),n.getRotationSpeed=(()=>{return h}),n.setRotationAccel=(e=>{m=e}),n.getRotationAccel=(()=>{return m}),n.setMinRotationSpeed=(e=>{I=e}),n.getMinRotationSpeed=(()=>{return I}),n.setMaxRotationSpeed=(e=>{O=e}),n.getMaxRotationSpeed=(()=>{return O}),n.setToAngle=(e=>{W=e}),n.getToAngle=(()=>{return W}),n.setAlpha=(e=>{u=e}),n.getAlpha=(()=>{return u}),n.setFadingSpeed=(e=>{R=e}),n.getFadingSpeed=(()=>{return R}),n.setFadingAccel=(e=>{C=e}),n.getFadingAccel=(()=>{return C}),n.setMinFadingSpeed=(e=>{x=e}),n.getMinFadingSpeed=(()=>{return x}),n.setMaxFadingSpeed=(e=>{H=e}),n.getMaxFadingSpeed=(()=>{return H}),n.setToAlpha=(e=>{b=e}),n.getToAlpha=(()=>{return b}),n.getDrawingX=(()=>{return B}),n.getDrawingY=(()=>{return K}),n.getRealX=(()=>{return _}),n.getRealY=(()=>{return U}),n.getRealScaleX=(()=>{return G}),n.getRealScaleY=(()=>{return q}),n.getRealRadian=(()=>{return z}),n.getRealSin=(()=>{return Z}),n.getRealCos=(()=>{return J}),n.getBeforeX=(()=>{return j}),n.getBeforeY=(()=>{return Q}),()=>{Te(d),Ye(l),De(g),Ce()});void 0!==t&&(i=t.x,o=t.y,a=t.centerX,r=t.centerY,c=t.zIndex,void 0!==t.scale&&Xe(t.scale),void 0!==t.scaleX&&(l=t.scaleX),void 0!==t.scaleY&&(g=t.scaleY),d=t.angle,u=t.alpha,f=t.speedX,S=t.speedY,void 0!==t.scalingSpeed&&Ie(t.scalingSpeed),void 0!==t.scalingSpeedX&&(s=t.scalingSpeedX),void 0!==t.scalingSpeedY&&(v=t.scalingSpeedY),h=t.rotationSpeed,R=t.fadingSpeed,p=t.accelX,E=t.accelY,void 0!==t.scalingAccel&&xe(t.scalingAccel),void 0!==t.scalingAccelX&&(y=t.scalingAccelX),void 0!==t.scalingAccelY&&(k=t.scalingAccelY),m=t.rotationAccel,C=t.fadingAccel,w=t.minSpeedX,Y=t.minSpeedY,void 0!==t.minScaleSpeed&&setMinScaleSpeed(t.minScaleSpeed),void 0!==t.minScaleSpeedX&&(minScaleSpeedX=t.minScaleSpeedX),void 0!==t.minScaleSpeedY&&(minScaleSpeedY=t.minScaleSpeedY),I=t.minRotationSpeed,x=t.minFadingSpeed,A=t.maxSpeedX,T=t.maxSpeedY,void 0!==t.maxScaleSpeed&&setMaxScaleSpeed(t.maxScaleSpeed),void 0!==t.maxScaleSpeedX&&(maxScaleSpeedX=t.maxScaleSpeedX),void 0!==t.maxScaleSpeedY&&(maxScaleSpeedY=t.maxScaleSpeedY),O=t.maxRotationSpeed,H=t.maxFadingSpeed,L=t.toX,V=t.toY,void 0!==t.toScale&&Ae(t.toScale),void 0!==t.toScaleX&&(F=t.toScaleX),void 0!==t.toScaleY&&(N=t.toScaleY),W=t.toAngle,b=t.toAlpha,void 0!==t.isHiding&&(se=t.isHiding),ae=t.filter,re=t.blendMode),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=0),void 0===f&&(f=0),void 0===S&&(S=0),void 0===p&&(p=0),void 0===E&&(E=0),void 0===l&&(l=1),void 0===g&&(g=1),void 0===s&&(s=0),void 0===v&&(v=0),void 0===y&&(y=0),void 0===k&&(k=0),void 0===d&&(d=0),void 0===h&&(h=0),void 0===m&&(m=0),void 0===u&&(u=1),void 0===R&&(R=0),void 0===C&&(C=0),SkyEngine.Screen!==n&&SkyEngine.Screen.registerNode(n);let Me=(n.setFilter=(e=>{ae=e}),n.getFilter=(()=>{return ae}),n.removeFilter=(()=>{ae=void 0}),n.setBlendMode=(e=>{re=e}),n.getBlendMode=(()=>{return re}),n.removeBlendMode=(()=>{re=void 0}),n.moveLeft=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(f=-e.speed),void 0!==e.accel&&(p=-e.accel),void 0!==e.maxSpeed&&(w=-e.maxSpeed)):(p=0,f=w=-e)})),Oe=(n.stopLeft=(e=>{void 0!==e?(p=e,A=0):f<0&&(f=0)}),n.moveRight=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(f=e.speed),void 0!==e.accel&&(p=e.accel),void 0!==e.maxSpeed&&(A=e.maxSpeed)):(p=0,f=A=e)})),He=(n.stopRight=(e=>{void 0!==e?(p=-e,w=0):f>0&&(f=0)}),n.moveUp=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=-e.speed),void 0!==e.accel&&(E=-e.accel),void 0!==e.maxSpeed&&(Y=-e.maxSpeed)):(E=0,S=Y=-e)})),Le=(n.stopUp=(e=>{void 0!==e?(E=e,T=0):S<0&&(S=0)}),n.moveDown=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=e.speed),void 0!==e.accel&&(E=e.accel),void 0!==e.maxSpeed&&(T=e.maxSpeed)):(E=0,S=T=e)})),Ve=(n.stopDown=(e=>{void 0!==e?(E=-e,Y=0):S>0&&(S=0)}),n.moveTo=((e,n)=>{if(void 0===e.y)L=e.x,L<i?Me(e):Oe(e),ee=n;else if(void 0===e.x)V=e.y,V<o?He(e):Le(e),ne=n;else{L=e.x,V=e.y;let t=L-i,c=V-o,a=Math.sqrt(t*t+c*c);void 0!==e.speed&&(f=e.speed*t/a,S=e.speed*c/a),void 0!==e.accel&&(p=e.accel*t/a,E=e.accel*c/a),void 0!==e.maxSpeed&&(A=e.maxSpeed*t/a,T=e.maxSpeed*c/a),$=n}}),n.stuckLeft=(()=>{le=!0}),n.unstuckLeft=(()=>{le=!1}),n.stuckRight=(()=>{ge=!0}),n.unstuckRight=(()=>{ge=!1}),n.stuckUp=(()=>{de=!0}),n.unstuckUp=(()=>{de=!1}),n.stuckDown=(()=>{ue=!0}),n.unstuckDown=(()=>{ue=!1}),n.rotate=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(I=e.minSpeed),void 0!==e.maxSpeed&&(O=e.maxSpeed)):h=e}),n.stopRotation=(e=>{void 0!==e?(m=-e,e>0?I=0:e<0&&(O=0)):h>0&&(h=0)}),n.rotateTo=((e,n)=>{W=e.toAngle,void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(I=e.minSpeed),void 0!==e.maxSpeed&&(O=e.maxSpeed),te=n}),n.flipX=(()=>{l=-l}),n.flipY=(()=>{g=-g}),n.fadeIn=((e,n)=>{b=1,CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.maxSpeed&&(H=e.maxSpeed)):R=e,ie=n}),n.fadeOut=((e,n)=>{b=0,CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=-e.speed),void 0!==e.accel&&(C=-e.accel),void 0!==e.maxSpeed&&(x=-e.maxSpeed)):R=-e,ie=n}),n.stopFading=(e=>{void 0!==e?(C=-e,e>0?x=0:e<0&&(H=0)):R>0&&(R=0)}),n.fadeTo=((e,n)=>{b=e.toAlpha,void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.minSpeed&&(x=e.minSpeed),void 0!==e.maxSpeed&&(H=e.maxSpeed),ie=n}),n.hide=(()=>{se=!0}),n.show=(()=>{se=!1}),n.checkIsHiding=(()=>{return se}),n.checkIsShowing=(()=>{return se!==!0}),n.getChildren=(()=>{return Se}),n.getParent=(()=>{return oe}),n.setTarget=(e=>{ce=e,ve!==!0&&void 0!==ce&&(Pe(),n.getTouchAreas().forEach(e=>{e.setTarget(n)}),n.getColliders().forEach(e=>{e.setTarget(n)}),n.getChildren().forEach(e=>{e.setTarget(n)}))})),Fe=n.setParent=(e=>{oe=e,Ve(oe)}),Ne=()=>{let e=oe.getChildren(),t=0,i=e.length;for(;t<i;){let n=t+i>>>1;e[n].getZIndex()<=c?t=n+1:i=n}e.splice(t,0,n)},We=()=>{let e=oe.getChildren(),t=0,i=e.length-1,o=0;for(;t<=i;){let a=Math.ceil((t+i)/2),r=e[a];if(r.getZIndex()<c)t=a+1;else{if(!(r.getZIndex()>c)){for(;;){if(e[a-o]===n){e.splice(a-o,1);break}if(o>0&&e[a+o]===n){e.splice(a+o,1);break}if(e[a-o].getZIndex()!==c&&e[a+o].getZIndex()!==c)break;o+=1}break}i=a-1}}},be=(n.appendTo=(e=>{return void 0!==oe&&We(),Fe(e),Ne(),n}),n.append=(e=>{e.appendTo(n)}),n.empty=(()=>{Se.forEach(e=>{e.setParent(void 0),e.remove()}),Se=[]})),_e=(n.remove=(()=>{Ue("remove"),be(),Se=void 0,void 0!==oe&&(We(),Fe(void 0)),SkyEngine.Screen!==n&&SkyEngine.Screen.unregisterNode(n),he=void 0,pe.forEach(e=>{e.remove()}),pe=void 0,Re.forEach(e=>{e.remove()}),Re=void 0,Ee=void 0,ye=void 0,ke=void 0,me=void 0,void 0!==fe&&fe.remove(),ve=!0}),n.checkIsRemoved=(()=>{return ve}),n.addDom=(e=>{void 0===fe&&(fe=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),fe.append(e)}),n.getDomWrapper=(()=>{return void 0===fe&&(fe=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),fe}),n.addDomStyle=(e=>{void 0!==fe&&fe.addStyle(e)}),n.removeAllDoms=(()=>{void 0!==fe&&fe.empty()}),n.on=((e,t)=>{ve===!0?"remove"===e&&t(EMPTY_E(),n):(void 0===he[e]&&(he[e]=[]),he[e].push(t))}),n.checkIsEventExists=(e=>{return void 0!==he[e]}),n.off=((e,n)=>{ve!==!0&&void 0!==he[e]&&(void 0!==n&&REMOVE({array:he[e],value:n}),void 0!==n&&0!==he[e].length||delete he[e])})),Ue=n.fireEvent=(e=>{let t,i;CHECK_IS_DATA(e)!==!0?t=e:(t=e.eventName,i=e.e),void 0!==he[t]&&he[t].forEach(e=>{e(void 0===i?EMPTY_E():i,n)})}),Be=(n.onMeet=((e,n)=>{Ee.push(e),void 0===ke[e.id]&&(ke[e.id]=[]),ke[e.id].push(n),Ge()}),n.offMeet=((e,n)=>{void 0===n?delete ke[e.id]:REMOVE({array:ke[e.id],value:n})}),n.runMeetHandlers=((e,n)=>{void 0!==ke[e.id]&&ke[e.id].forEach(e=>{e(n)})})),Ke=(n.onPart=((e,n)=>{Ee.push(e),void 0===me[e.id]&&(me[e.id]=[]),me[e.id].push(n)}),n.offPart=((e,n)=>{void 0===n?delete me[e.id]:REMOVE({array:me[e.id],value:n})}),n.runPartHandlers=((e,n)=>{void 0!==me[e.id]&&me[e.id].forEach(e=>{e(n)})})),Ge=(n.addTouchArea=(e=>{pe.push(e),e.setTarget(n)}),n.getTouchAreas=(()=>{return pe}),n.getTouchArea=(()=>{return pe[0]}),n.addCollider=(e=>{Re.push(e),e.setTarget(n)}),n.getColliders=(()=>{return Re}),n.getCollider=(()=>{return Re[0]}),n.checkPoint=((e,n)=>{return Se.every(t=>{return t.checkPoint(e,n)!==!0})!==!0}),n.checkArea=(e=>{return Se.every(n=>{return n.checkArea(e)!==!0&&e.checkArea(n)!==!0})!==!0}),n.checkTouch=((e,t)=>{return ve!==!0&&n.checkIsHiding()!==!0&&(pe.every(n=>{return n.checkPoint(e,t)!==!0})!==!0||Se.every(n=>{return n.checkTouch(e,t)!==!0})!==!0)}),n.checkCollision=(e=>{return ve!==!0&&n.checkIsHiding()!==!0&&(e.type===CLASS?SkyEngine.Screen.getRegisteredNodes(e).every(e=>{if(e!==n)return n.checkCollision(e)!==!0})!==!0:e.checkIsHiding()!==!0&&(Re.every(n=>{return e.checkIsRemoved()!==!0&&e.getColliders().every(e=>{return n.checkArea(e)!==!0&&e.checkArea(n)!==!0})})!==!0||Se.every(n=>{return n.checkCollision(e)!==!0})!==!0))}),n.checkOffScreen=(()=>{return Se.every(e=>{return e.checkOffScreen()===!0})===!0}),()=>{Ee.forEach((e,t,i)=>{e.type===CLASS?SkyEngine.Screen.getRegisteredNodes(e).forEach(t=>{t!==n&&(t.checkIsRemoved()!==!0?n.checkCollision(t)===!0||n.type!==t.type&&t.checkCollision(n)===!0?ve!==!0&&void 0===ye[t.id]&&(ye[t.id]=!0,Be(e,t)):ve!==!0&&void 0!==ye[t.id]&&(delete ye[t.id],Ke(e,t)):delete ye[t.id])}):e.checkIsRemoved()!==!0?n.checkCollision(e)===!0||n.type!==e.type&&e.checkCollision(n)===!0?void 0===ye[e.id]&&(ye[e.id]=!0,Be(e,e)):void 0!==ye[e.id]&&(delete ye[e.id],Ke(e,e)):(i.splice(t,1),delete ye[e.id],delete ke[e.id],delete me[e.id])})});n.step=(e=>{if(j=i,Q=o,0!==p&&(f+=p*e),void 0!==w&&f<w&&(f=w),void 0!==A&&f>A&&(f=A),0!==E&&(S+=E*e),void 0!==Y&&S<Y&&(S=Y),void 0!==T&&S>T&&(S=T),0!==f){let n=f*e;if((n<0&&le!==!0||n>0&&ge!==!0)&&(i+=n,void 0!==L&&(f>0&&i>L||f<0&&i<L))){if(i=L,f=0,p=0,void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}}if(0!==S){let n=S*e;if((n<0&&de!==!0||n>0&&ue!==!0)&&(o+=n,void 0!==V&&(S>0&&o>V||S<0&&o<V))){if(o=V,S=0,E=0,void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===f){let e=$;$=void 0,e()}}}if(0!==y&&(s+=y*e),void 0!==D&&s<D&&(s=D),void 0!==P&&s>P&&(s=P),0!==k&&(v+=k*e),void 0!==X&&v<X&&(v=X),void 0!==M&&v>M&&(v=M),0!==s&&(l+=s*e,void 0!==F&&(s>0&&l>F||s<0&&l<F)&&(l=F,s=0,y=0)),0!==v&&(g+=v*e,void 0!==N&&(v>0&&g>N||v<0&&g<N)&&(g=N,v=0,k=0)),0!==m&&(h+=m*e),void 0!==I&&h<I&&(h=I),void 0!==O&&h>O&&(h=O),0!==h){if(d+=h*e,void 0!==W&&d+W<360&&(h>0&&d>=W||h<0&&d<=W)&&(d=W,h=0,m=0,void 0!==te)){te=void 0,_frotateEndHandler()}d>=360?d=0:d<=0&&(d=360)}if(0!==C&&(R+=C*e),void 0!==x&&R<x&&(R=x),void 0!==H&&R>H&&(R=H),0!==R){if(u+=R*e,void 0!==b&&(R>0&&u>b||R<0&&u<b)&&(u=b,R=0,C=0,void 0!==ie)){let e=ie;ie=void 0,e()}u>1?u=1:u<0&&(u=0)}Pe(),ve!==!0&&pe.forEach(n=>{n.step(e)}),ve!==!0&&Re.forEach(n=>{n.step(e)}),ve!==!0&&Ge(),ve!==!0&&Se.forEach(n=>{n.step(e)}),ve!==!0&&void 0!==he.offscreen&&n.checkOffScreen()===!0&&Ue("offscreen"),ve!==!0&&void 0!==he.nextstep&&(Ue("nextstep"),_e("nextstep")),ve===!0||void 0===he.move||i===j&&o===Q||Ue("move")}),n.draw=(e=>{if(void 0!==fe){let n=SkyEngine.Screen.getRatio();fe.addStyle({left:SkyEngine.Screen.getLeft()+(SkyEngine.Screen.getWidth()/2+B)*n-fe.getWidth()/2,top:SkyEngine.Screen.getTop()+(SkyEngine.Screen.getHeight()/2+K)*n-fe.getHeight()/2,transform:"rotate("+z+"rad) scale("+n*G+", "+n*q+")",opacity:e.globalAlpha,filter:e.filter})}}),n.drawArea=(e=>{});Pe()},afterInit:(e,n,t)=>{void 0!==t&&(void 0!==t.c&&(CHECK_IS_ARRAY(t.c)===!0?EACH(t.c,e=>{n.append(e)}):n.append(t.c)),void 0!==t.dom&&(CHECK_IS_ARRAY(t.dom)===!0?EACH(t.dom,e=>{n.addDom(e)}):n.addDom(t.dom)),void 0!==t.domStyle&&n.addDomStyle(t.domStyle),void 0!==t.on&&EACH(t.on,(e,t)=>{n.on(t,e)}),void 0!==t.touchArea&&(CHECK_IS_ARRAY(t.touchArea)===!0?EACH(t.touchArea,e=>{n.addTouchArea(e)}):n.addTouchArea(t.touchArea)),void 0!==t.collider&&(CHECK_IS_ARRAY(t.collider)===!0?EACH(t.collider,e=>{n.addCollider(e)}):n.addCollider(t.collider)))}}),SkyEngine.Screen=OBJECT({preset:()=>{return SkyEngine.Node},init:(e,n)=>{let t,i,o,c,a,r,l,g,d,u,f=DIV({style:{position:"fixed",left:0,top:0,zIndex:-1}}).appendTo(BODY),S=CANVAS().appendTo(f),s=S.getContext("2d"),v={};n.registerNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;)void 0===v[n.id]&&(v[n.id]=[]),v[n.id].push(e),n=n.mom}),n.unregisterNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;)void 0!==v[n.id]&&(REMOVE({array:v[n.id],value:e}),0===v[n.id].length&&delete v[n.id]),n=n.mom}),n.getRegisteredNodes=(e=>{return void 0===v[e.id]?[]:v[e.id]});if(CONFIG.SkyEngine.isDebugMode===!0){let e=DIV({style:{position:"fixed",left:5,top:5,fontSize:12,zIndex:999999}}).appendTo(BODY);INTERVAL(.1,()=>{void 0!==r&&(e.empty(),e.append("FPS: "+parseInt(1/r)))})}EACH(["tap","touchstart","touchend"],e=>{S.on(e,t=>{let i,a=n=>{if(i!==!0&&(REVERSE_EACH(n.getChildren(),a),n.checkIsEventExists(e)===!0&&n.checkTouch(t.getLeft()-o/2,t.getTop()-c/2)===!0)){let o=SkyEngine.E(t);n.fireEvent({eventName:e,e:o}),o.checkIsBubblingStoped()===!0&&(i=!0)}};a(n)})});let h=(e,n,t)=>{n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.lineWidth=1/(e.getRealScaleX()>e.getRealScaleY()?e.getRealScaleX():e.getRealScaleY()),n.beginPath(),e.drawArea(n),n.strokeStyle=t,n.stroke(),n.closePath(),n.restore(),e.getChildren().forEach(e=>{h(e,n,t)})},R=(e,n,t)=>{if(e.checkIsHiding()!==!0&&(t*=e.getAlpha(),n.save(),void 0!==e.getFilter()&&(n.filter=e.getFilter()),void 0!==e.getBlendMode()&&(n.globalCompositeOperation=e.getBlendMode()),n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.globalAlpha=t,e.draw(n),n.restore(),e.checkIsRemoved()!==!0&&e.getChildren().forEach(e=>{R(e,n,t)}),n.restore(),e.checkIsRemoved()!==!0&&CONFIG.SkyEngine.isDebugMode===!0)){n.beginPath(),n.strokeStyle=n.fillStyle="aqua";let t=e.getRealX(),i=e.getRealY();n.rect(t-1,i-1,2,2),n.moveTo(t-15,i),n.lineTo(t+15,i),n.moveTo(t,i-15),n.lineTo(t,i+15),n.stroke(),e.getTouchAreas().forEach(e=>{h(e,n,"magenta")}),e.getColliders().forEach(e=>{h(e,n,"lime")})}},p=LOOP(e=>{r=e,r>.03&&(r=.03),SkyEngine.Delay.step(r),SkyEngine.Interval.step(r),n.step(r),s.clearRect(0,0,o*devicePixelRatio,c*devicePixelRatio),s.save(),s.scale(devicePixelRatio,devicePixelRatio),s.translate(o/2-C(),c/2-w()),R(n,s,n.getAlpha()),s.restore()});EVENT("resize",RAR(()=>{let e=WIN_WIDTH(),n=WIN_HEIGHT();o=void 0!==CONFIG.SkyEngine.width?CONFIG.SkyEngine.width:e,c=void 0!==CONFIG.SkyEngine.height?CONFIG.SkyEngine.height:n;let r=e/o,l=n/c;a=r<l?r:l,S.addStyle({width:o*a,height:c*a}),t=(e-o*a)/2,i=(n-c*a)/2,f.addStyle({left:t,top:i}),S.setSize({width:o*devicePixelRatio,height:c*devicePixelRatio})})),n.on("remove",()=>{p.remove()});let E=n.cameraFollowX=(e=>{d=e.target,l=e.centerX,void 0===E&&(E=0)}),y=n.cameraFollowY=(e=>{u=params.target,g=params.centerY,void 0===y&&(y=0)}),k=(n.cameraFollow=(e=>{E(params),y(params)}),n.cameraUnfollowX=(e=>{d=void 0})),m=n.cameraUnfollowY=(e=>{u=void 0}),C=(n.cameraUnfollow=(e=>{k(),m()}),n.getCameraFollowX=(()=>{return void 0===d?0:d.checkIsRemoved()===!0?(d=void 0,0):d.getRealX()-l})),w=n.getCameraFollowY=(()=>{return void 0===u?0:u.checkIsRemoved()===!0?(u=void 0,0):u.getRealY()-g});n.getLeft=(()=>{return t}),n.getTop=(()=>{return i}),n.getWidth=(()=>{return o}),n.getHeight=(()=>{return c}),n.getRatio=(()=>{return a}),n.getCanvas=(()=>{return S}),n.getCanvasContext=(()=>{return s})}}),SkyEngine.Figure=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a=t.color,r=t.border;if(void 0!==r){let e=r.split(" ");i=INTEGER(e[0]),o=e[1],c=e[2]}let l;OVERRIDE(n.draw,e=>{l=n.draw=(n=>{void 0!==a&&(n.fillStyle=a,n.fill()),void 0!==r&&(n.lineWidth=i,n.strokeStyle=c,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke()),n.closePath(),e(n)})});let g;OVERRIDE(n.drawArea,e=>{g=n.drawArea=(n=>{e(n)})})}}),SkyEngine.StateSet=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a={},r=n.setStateNode=(e=>{let t=e.state,i=e.node;void 0!==a[name]&&a[name].remove(),i.hide(),n.append(i),a[t]=i});EACH(t.stateNodes,(e,n)=>{r({state:n,node:e})});let l=n.setState=(e=>{void 0!==c&&(a[i].off("animationend",c),c=void 0),i!==e&&(i=e,EACH(a,e=>{e.hide()}),a[i].show())});l(t.baseState);n.setToState=(e=>{i!==e&&(o=e,a[i].on("animationend",c=(()=>{l(o)})))}),n.getState=(()=>{return i})}}),SkyEngine.Circle=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,c,a,r,l,g)=>{let d=g*e+l*n-t,u=-l*e+g*n-i;o*=a,c*=r;let f=o/2,S=c/2,s=99999,v=(1-d*s/f/f*S*S)/u+i;s+=t;let h=-99999,R=(1-d*h/f/f*S*S)/u+i;return h+=t,SkyEngine.Line.findCircleIntersectionPoints(0,0,s,v,h,R,1,1,0,1,t,i,o,c,1,1,l,g)});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.width,c=i.height,a=SkyEngine.Util.Collision.checkPointInCircle,r=SkyEngine.Util.Collision.checkLineCircle,l=SkyEngine.Util.Collision.checkRectCircle,g=SkyEngine.Util.Collision.checkCircleCircle;t.setWidth=(e=>{o=e}),t.getWidth=(()=>{return o}),t.setHeight=(e=>{c=e}),t.getHeight=(()=>{return c});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return a(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let d;OVERRIDE(t.checkArea,e=>{d=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle&&g(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let u;OVERRIDE(t.checkOffScreen,e=>{u=t.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let f;OVERRIDE(t.draw,e=>{f=t.draw=(n=>{n.beginPath(),n.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(n)})});let S;OVERRIDE(t.drawArea,e=>{S=t.drawArea=(n=>{n.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(n)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Line=CLASS(e=>{let n=e.findLineIntersectionPoint=((e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R,p,E)=>{if(SkyEngine.Util.Collision.checkLineLine(e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R,p,E)===!0){t*=a,i*=r;let y=e+g*t+l*i,k=n+l*t+g*i;o*=a,c*=r;let m=e+g*o+l*c,C=n+l*o+g*c;f*=h,S*=R;let w=d+E*f+p*S,Y=u+p*f+E*S;s*=h,v*=R;let D=d+E*s+p*v,X=u+p*s+E*v,I=(m-y)*(X-Y)-(D-w)*(C-k);return{x:((m*k-C*y)*(D-w)-(m-y)*(D*Y-X*w))/I,y:((m*k-C*y)*(X-Y)-(C-k)*(D*Y-X*w))/I}}}),t=e.findRectIntersectionPoints=((e,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R,p)=>{let E=[];i*=r,o*=l;let y=e+d*i+g*o,k=t+g*i+d*o;c*=r,a*=l;let m,C,w,Y,D,X,I,x,A=e+d*c+g*a,T=t+g*c+d*a;S*=v/2,s*=h/2;let P=p*S,M=p*s,O=-R*S,H=-R*s;m=u-P-H,C=f+O-M,w=u+P-H,Y=f-O-M,D=u+P+H,X=f-O+M,I=u-P+H,x=f+O+M;let L=n(0,0,y,k,A,T,1,1,0,1,0,0,m,C,w,Y,1,1,0,1);return void 0!==L&&E.push(L),L=n(0,0,y,k,A,T,1,1,0,1,0,0,w,Y,D,X,1,1,0,1),void 0!==L&&E.push(L),L=n(0,0,y,k,A,T,1,1,0,1,0,0,D,X,I,x,1,1,0,1),void 0!==L&&E.push(L),L=n(0,0,y,k,A,T,1,1,0,1,0,0,I,x,m,C,1,1,0,1),void 0!==L&&E.push(L),E}),i=e.findCircleIntersectionPoints=((e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R)=>{let p=[];if(SkyEngine.Util.Collision.checkLineCircle(e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R)===!0){t*=a,i*=r;let E=e+g*t+l*i-d,y=n+l*t+g*i-u;o*=a,c*=r;let k=e+g*o+l*c-d,m=n+l*o+g*c-u,C=R*E+h*y,w=-h*E+R*y,Y=R*k+h*m,D=-h*k+R*m;f*=s,S*=v;let X=f/2,I=S/2,x=(D-w)/(Y-C),A=w-x*C,T=x*x*X*X+I*I,P=2*x*A*X*X,M=X*X*A*A-X*X*I*I,O=P*P-4*T*M;if(O>0){let e=(-P+Math.sqrt(O))/(2*T),n=x*e+A,t=(-P-Math.sqrt(O))/(2*T),i=x*t+A;(C<Y?C:Y)<=e&&e<=(C<Y?Y:C)&&(w<D?w:D)<=n&&n<=(w<D?D:w)&&p.push({x:R*e-h*n+d,y:h*e+R*n+u}),(C<Y?C:Y)<=t&&t<=(C<Y?Y:C)&&(w<D?w:D)<=i&&i<=(w<D?D:w)&&p.push({x:R*t-h*i+d,y:h*t+R*i+u})}else if(0==O){let e=-P/(2*T),n=x*e+A;(C<Y?C:Y)<=e&&e<=(C<Y?Y:C)&&(w<D?w:D)<=n&&n<=(w<D?D:w)&&p.push({x:R*e-h*n+d,y:h*e+R*n+u})}}return p}),o=e.findPolygonIntersectionPoints=((e,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R)=>{let p=[];i*=r,o*=l;let E=e+d*i+g*o,y=t+g*i+d*o;c*=r,a*=l;let k=e+d*c+g*a,m=t+g*c+d*a,C=S.length;for(let w=0,Y=C-1;w<C;Y=w,w+=1){let e=S[w].x*s,t=S[w].y*v,i=S[Y].x*s,o=S[Y].y*v,c=u+R*e-h*t,a=f+h*e+R*t,r=u+R*i-h*o,l=f+h*i+R*o,g=n(0,0,E,y,k,m,1,1,0,1,0,0,c,a,r,l,1,1,0,1);void 0!==g&&p.push(g)}return p});return{preset:()=>{return SkyEngine.Figure},init:(e,c,a)=>{let r=a.startX,l=a.startY,g=a.endX,d=a.endY,u=a.isEndless,f=SkyEngine.Util.Collision.checkLineLine,S=SkyEngine.Util.Collision.checkLineRect;u===!0&&(Math.abs(g-r)<Math.abs(d-l)?(g=((d-l<0?-999999:999999)-l)/(d-l)*(g-r)+r,d=d-l<0?-999999:999999):(d=(d-l)/(g-r)*((g-r<0?-999999:999999)-r)+l,g=g-r<0?-999999:999999));let s;c.setStartX=(e=>{r=e}),c.getStartX=(()=>{return r}),c.setStartY=(e=>{l=e}),c.getStartY=(()=>{return l}),c.setEndX=(e=>{g=e}),c.getEndX=(()=>{return g}),c.setEndY=(e=>{d=e}),c.getEndY=(()=>{return d});OVERRIDE(c.checkArea,e=>{s=c.checkArea=(n=>{return n.type===SkyEngine.Line&&f(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos())===!0||e(n)})});let v;OVERRIDE(c.checkOffScreen,e=>{v=c.checkOffScreen=(()=>{return S(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1)!==!0&&e()})});let h;OVERRIDE(c.draw,e=>{h=c.draw=(n=>{n.beginPath(),n.moveTo(r,l),n.lineTo(g,d),e(n)})});let R;OVERRIDE(c.drawArea,e=>{R=c.drawArea=(n=>{n.moveTo(r,l),n.lineTo(g,d),e(n)})});c.findIntersectionPoints=(e=>{let a=[];if(e.checkIsInstanceOf(SkyEngine.Line)===!0){let t=n(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getStartX(),e.getStartY(),e.getEndX(),e.getEndY(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos());void 0!==t&&a.push(t)}else e.checkIsInstanceOf(SkyEngine.Rect)===!0?a=t(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Circle)===!0?a=i(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Polygon)===!0&&(a=o(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getPoints(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()));return a})}}}),SkyEngine.Polygon=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,c,a,r,l)=>{let g,d,u,f,S,s,v=o.length;for(let h=0;h<v;h+=1){let v=o[h].x*c,R=o[h].y*a,p=t+l*v-r*R,E=i+r*v+l*R,y=p-e,k=E-n,m=Math.acos(y/Math.sqrt(y*y+k*k));k>0&&(m=Math.PI+Math.PI-m),(void 0==g||g>m)&&(g=m,d=p,u=E),(void 0==f||f<m)&&(f=m,S=p,s=E)}return void 0===g?[]:[{x:d,y:u},{x:S,y:s}]});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.points,c=SkyEngine.Util.Collision.checkPointInPolygon,a=SkyEngine.Util.Collision.checkLinePolygon,r=SkyEngine.Util.Collision.checkRectPolygon,l=SkyEngine.Util.Collision.checkCirclePolygon,g=SkyEngine.Util.Collision.checkPolygonPolygon;t.getPoints=(()=>{return o}),t.setColor=(e=>{e=_color}),t.getColor=(()=>{return color});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return c(n,i,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let d;OVERRIDE(t.checkArea,e=>{d=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(a(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(r(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Polygon&&g(n.getDrawingX(),n.getDrawingY(),n.getPoints(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let u;OVERRIDE(t.checkOffScreen,e=>{u=t.checkOffScreen=(()=>{return r(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let f;OVERRIDE(t.draw,e=>{f=t.draw=(n=>{if(n.beginPath(),o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x,t.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});let S;OVERRIDE(t.drawArea,e=>{S=t.drawArea=(n=>{if(o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x,t.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Rect=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,c,a,r,l,g)=>{let d,u,f,S,s,v,h,R;o*=a,c*=r;let p=g*o/2,E=g*c/2,y=-l*o/2,k=-l*c/2;d=t-p-k,u=i+y-E,f=t+p-k,S=i-y-E,s=t+p+k,v=i-y+E,h=t-p+k,R=i+y+E;let m=d-e,C=u-n,w=Math.acos(m/Math.sqrt(m*m+C*C));C>0&&(w=Math.PI+Math.PI-w);let Y=w,D=d,X=u,I=w,x=d,A=u;return m=f-e,C=S-n,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),Y>w&&(Y=w,D=f,X=S),I<w&&(I=w,x=f,A=S),m=s-e,C=v-n,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),Y>w&&(Y=w,D=s,X=v),I<w&&(I=w,x=s,A=v),m=h-e,C=R-n,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),Y>w&&(Y=w,D=h,X=R),I<w&&(I=w,x=h,A=R),[{x:D,y:X},{x:x,y:A}]});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.width,c=i.height,a=SkyEngine.Util.Collision.checkPointInRect,r=SkyEngine.Util.Collision.checkLineRect,l=SkyEngine.Util.Collision.checkRectRect;t.setWidth=(e=>{o=e}),t.getWidth=(()=>{return o}),t.setHeight=(e=>{c=e}),t.getHeight=(()=>{return c}),t.setColor=(e=>{e=_color}),t.getColor=(()=>{return color});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return a(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let g;OVERRIDE(t.checkArea,e=>{g=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect&&l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;
return e(n)})});let d;OVERRIDE(t.checkOffScreen,e=>{d=t.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let u;OVERRIDE(t.draw,e=>{u=t.draw=(n=>{n.beginPath(),n.rect(-o/2,-c/2,o,c),e(n)})});let f;OVERRIDE(t.drawArea,e=>{f=t.drawArea=(n=>{n.rect(-o/2,-c/2,o,c),e(n)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Background=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i=t.src,o=t.isNotToRepeatX,c=t.isNotToRepeatY,a=t.cameraFollowRatio;void 0===a&&(a=0);let r,l,g=new Image;g.onload=(()=>{r=g.width,l=g.height,g.onload=void 0,n.fireEvent("load")}),g.src=i;let d,u,f;OVERRIDE(n.step,e=>{f=n.step=(t=>{if(1!==a){let e=SkyEngine.Screen.getCameraFollowX(),t=SkyEngine.Screen.getCameraFollowY();void 0!==d&&n.setX(n.getX()+(e-d)*(1-a)/n.getRealScaleX()),void 0!==u&&n.setY(n.getY()+(t-u)*(1-a)/n.getRealScaleY()),d=e,u=t}e(t)})});let S;OVERRIDE(n.draw,e=>{S=n.draw=(t=>{if(void 0!==r)if(o===!0&&c===!0)t.drawImage(g,-r/2,-l/2,r,l);else if(o===!0){let e=-l/2,i=SkyEngine.Screen.getCameraFollowY()/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),o=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;i-o<e+n.getRealY();)e-=l;for(;e<i+o;)t.drawImage(g,-r/2,e,r,l),e+=l}else if(c===!0){let e=-r/2,i=SkyEngine.Screen.getCameraFollowX()/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),o=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX();for(;i-o<e+n.getRealX();)e-=r;for(;e<i+o;)t.drawImage(g,e,-l/2,r,l),e+=r}else{let e=-r/2,i=-l/2,o=SkyEngine.Screen.getCameraFollowX()/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),c=SkyEngine.Screen.getCameraFollowY()/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),a=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),d=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;o-a<e;)e-=r;for(;c-d<i;)i-=l;for(;i<c+d;){let n=e;for(;n<o+a;)t.drawImage(g,n,i,r,l),n+=r;i+=l}}e(t)})});let s;OVERRIDE(n.remove,e=>{s=n.remove=(()=>{g.onload=void 0,g=void 0,e()})})}}),SkyEngine.Image=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a,r=t.src,l=SkyEngine.Util.Collision.checkRectRect,g=!1,d=new Image;d.onload=(()=>{c=d.width,a=d.height,d.onload=void 0,n.fireEvent("load")}),d.src=r;let u;OVERRIDE(n.checkPoint,e=>{u=n.checkPoint=((t,o)=>{if(void 0===i){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,t=e.height,o=CANVAS({style:{display:"none"},width:n,height:t}).appendTo(BODY),c=o.getContext("2d");c.drawImage(e,0,0,n,t),i=c.getImageData(0,0,n,t).data,c=void 0,o.remove(),e.onload=void 0}),e.src=r,g=!0}return e(t,o)===!0}let l=t-n.getDrawingX(),d=o-n.getDrawingY(),u=Math.cos(-n.getRealRadian()),f=Math.sin(-n.getRealRadian()),S=u*l-f*d,s=u*d+f*l;return S=parseInt((S+c*n.getRealScaleX()/2)/n.getRealScaleX()),s=parseInt((s+a*n.getRealScaleY()/2)/n.getRealScaleY()),S>=0&&S<c&&s>=0&&s<a&&i[4*(s*c+S)+3]>20||e(t,o)===!0})});let f;OVERRIDE(n.checkOffScreen,e=>{f=n.checkOffScreen=(()=>{return void 0!==c&&l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),c,a,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let S;OVERRIDE(n.draw,e=>{S=n.draw=(n=>{n.drawImage(d,-c/2,-a/2,c,a),e(n)})});let s;OVERRIDE(n.drawArea,e=>{s=n.drawArea=(n=>{if(void 0===o)if(void 0===i){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,t=e.height,c=CANVAS({style:{display:"none"},width:n,height:t}).appendTo(BODY),a=c.getContext("2d");a.drawImage(e,0,0,n,t),i=a.getImageData(0,0,n,t).data,o=SkyEngine.Util.ImageData.convertImageDataToPolygon(i,n),a=void 0,c.remove(),e.onload=void 0}),e.src=r,g=!0}}else o=SkyEngine.Util.ImageData.convertImageDataToPolygon(i,c);else if(o.length>0){n.moveTo(o[0].x-c/2,o[0].y-a/2);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x-c/2,t.y-a/2)}n.lineTo(o[0].x-c/2,o[0].y-a/2)}e(n)})});let v;OVERRIDE(n.remove,e=>{v=n.remove=(()=>{d.onload=void 0,d=void 0,i=void 0,o=void 0,e()})})}}}),SkyEngine.Silhouette=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a=t.src,r=t.color,l=t.border,g=SkyEngine.Util.Collision.checkRectRect;if(void 0!==l){let e=l.split(" ");i=INTEGER(e[0]),o=e[1],c=e[2]}let d,u,f,S,s,v=n.setSrc=(e=>{a=e,d=new Image,d.onload=(()=>{S=d.width,s=d.height;let e=CANVAS({style:{display:"none"},width:S,height:s}).appendTo(BODY),t=e.getContext("2d");t.drawImage(d,0,0,S,s);let i=t.getImageData(0,0,S,s);u=i.data;let o,c=u.length;for(o=0;o<c;o+=4)u[o]=0,u[o+1]=0,u[o+2]=0;d.onload=void 0,t.clearRect(0,0,S,s),t.putImageData(i,0,0),t.globalCompositeOperation="source-in",t.rect(0,0,S,s),t.fillStyle=r,t.fill(),d.src=e.getEl().toDataURL(),i=void 0,t=void 0,e.remove(),void 0!==l&&(f=SkyEngine.Util.ImageData.convertImageDataToPolygon(u,S)),n.fireEvent("load")}),d.src=a});v(a);let h;OVERRIDE(n.checkPoint,e=>{h=n.checkPoint=((t,i)=>{if(void 0===u)return e(t,i)===!0;let o=t-n.getDrawingX(),c=i-n.getDrawingY(),a=Math.cos(-n.getRealRadian()),r=Math.sin(-n.getRealRadian()),l=a*o-r*c,g=a*c+r*o;return l=parseInt((l+S*n.getRealScaleX()/2)/n.getRealScaleX()),g=parseInt((g+s*n.getRealScaleY()/2)/n.getRealScaleY()),l>=0&&l<S&&g>=0&&g<s&&u[4*(g*S+l)+3]>20||e(t,i)===!0})});let R;OVERRIDE(n.checkOffScreen,e=>{R=n.checkOffScreen=(()=>{return void 0!==S&&g(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),S,s,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let p;OVERRIDE(n.draw,e=>{p=n.draw=(n=>{if(void 0!==u&&(n.drawImage(d,-S/2,-s/2,S,s),void 0!==l&&f.length>0)){n.beginPath(),n.moveTo(f[0].x-S/2,f[0].y-s/2);for(let e=1;e<f.length;e+=1){let t=f[e];n.lineTo(t.x-S/2,t.y-s/2)}n.lineTo(f[0].x-S/2,f[0].y-s/2),n.lineWidth=i,n.strokeStyle=c,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke(),n.closePath()}e(n)})});let E;OVERRIDE(n.drawArea,e=>{E=n.drawArea=(n=>{if(void 0===f)void 0!==u&&(f=SkyEngine.Util.ImageData.convertImageDataToPolygon(u,S));else if(f.length>0){n.moveTo(f[0].x-S/2,f[0].y-s/2);for(let e=1;e<f.length;e+=1){let t=f[e];n.lineTo(t.x-S/2,t.y-s/2)}n.lineTo(f[0].x-S/2,f[0].y-s/2)}e(n)})});let y;OVERRIDE(n.remove,e=>{y=n.remove=(()=>{d.onload=void 0,d=void 0,u=void 0,f=void 0,e()})})}}}),SkyEngine.Sprite=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a,r,l=t.src,g=t.srcs,d=t.spriteWidth,u=t.spriteHeight,f=t.fps,S=SkyEngine.Util.Collision.checkRectRect,s=0,v=0,h=0,R=!1;void 0===f&&(f=0),void 0!==l&&(i=new Image,i.onload=(()=>{c=i.width,a=i.height,void 0===d&&(d=c),void 0===u&&(u=a),void 0===r&&(r=c/d*a/u),i.onload=void 0,n.fireEvent("load")}),i.src=l),void 0!==g&&EACH(g,e=>{let t=new Image;void 0===o&&(o=[]),t.onload=(()=>{c=t.width,a=t.height,void 0===d&&(d=c),void 0===u&&(u=a),void 0===r?r=1:r+=1,t.onload=void 0,n.fireEvent("load")}),t.src=e,o.push(t)});let p,E=(n.getFrame=(()=>{return v}),n.getBeforeFrame=(()=>{return h}),n.stop=(()=>{R=!0})),y=n.resume=(()=>{R=!1});OVERRIDE(n.hide,e=>{p=n.hide=(()=>{s=0,v=0,h=0,E(),e()})});let k;OVERRIDE(n.show,e=>{k=n.show=(()=>{s=0,v=0,h=0,y(),e()})});let m;OVERRIDE(n.checkOffScreen,e=>{m=n.checkOffScreen=(()=>{return void 0!==c&&S(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),d,u,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let C;OVERRIDE(n.step,e=>{C=n.step=(t=>{R!==!0&&(f>0&&(s+=f*t),void 0!==r&&s>=r&&(s-=r,n.fireEvent("animationend")),h=v,v=Math.floor(s),v!==h&&n.fireEvent("framechange")),e(t)})});let w;OVERRIDE(n.draw,e=>{w=n.draw=(n=>{if(void 0!==o){if(void 0!==r){let e=o[v];void 0!==e&&n.drawImage(e,-c/2,-a/2,c,a)}}else void 0!==c&&void 0!==a&&void 0!==d&&void 0!==u&&n.drawImage(i,d*Math.floor(s%(c/d)),u*Math.floor(s/(c/d)),d,u,-d/2,-u/2,d,u);e(n)})});let Y;OVERRIDE(n.remove,e=>{Y=n.remove=(()=>{g=void 0,void 0!==i&&(i.onload=void 0,i=void 0),EACH(o,e=>{e.onload=void 0}),o=void 0,e()})})}}),SkyEngine.ParticleSystem=CLASS(()=>{let e=(e,n)=>{return Math.random()*(n-e)+e};return{preset:()=>{return SkyEngine.Node},init:(n,t,i)=>{let o,c,a=i.particleSrc,r=i.particleFigure,l=i.particleStartX,g=i.particleStartY,d=i.particleEndX,u=i.particleEndY,f=i.particleWidth,S=i.particleHeight,s=i.particlePoints,v=i.particleColor,h=i.particleBorder,R=i.particleColorR,p=i.minParticleColorR,E=i.maxParticleColorR,y=i.particleColorG,k=i.minParticleColorG,m=i.maxParticleColorG,C=i.particleColorB,w=i.minParticleColorB,Y=i.maxParticleColorB,D=i.particleCenterX,X=i.particleCenterY,I=i.particleCount,x=i.minParticleCount,A=i.maxParticleCount,T=i.particleX,P=i.minParticleX,M=i.maxParticleX,O=i.particleY,H=i.minParticleY,L=i.maxParticleY,V=i.particleLifetime,F=i.minParticleLifetime,N=i.maxParticleLifetime,W=i.particleDirection,b=i.minParticleDirection,_=i.maxParticleDirection,U=i.particleSpeed,B=i.minParticleSpeed,K=i.maxParticleSpeed,G=i.particleAccelX,q=i.particleAccelY,z=i.particleScale,Z=i.minParticleScale,J=i.maxParticleScale,j=i.particleScalingSpeed,Q=i.minParticleScalingSpeed,$=i.maxParticleScalingSpeed,ee=i.isParticleAngleToDirection,ne=i.particleAngle,te=i.minParticleAngle,ie=i.maxParticleAngle,oe=i.particleRotationSpeed,ce=i.minParticleRotationSpeed,ae=i.maxParticleRotationSpeed,re=i.particleAlpha,le=i.minParticleAlpha,ge=i.maxParticleAlpha,de=i.particleFadingSpeed,ue=i.minParticleFadingSpeed,fe=i.maxParticleFadingSpeed;void 0===R&&(R=0),void 0===p&&(p=R),void 0===E&&(E=R),void 0===y&&(y=0),void 0===k&&(k=y),void 0===m&&(m=y),void 0===C&&(C=0),void 0===w&&(w=C),void 0===Y&&(Y=C),void 0===D&&(D=0),void 0===X&&(X=0),void 0===I&&(I=1),void 0===x&&(x=I),void 0===A&&(A=I),void 0===T&&(T=0),void 0===P&&(P=T),void 0===M&&(M=T),void 0===O&&(O=0),void 0===H&&(H=O),void 0===L&&(L=O),void 0===F&&(F=V),void 0===N&&(N=V),void 0===b&&(b=W),void 0===_&&(_=W),void 0===B&&(B=U),void 0===K&&(K=U),void 0===G&&(G=0),void 0===q&&(q=0),void 0===z&&(z=1),void 0===Z&&(Z=z),void 0===J&&(J=z),void 0===j&&(j=0),void 0===Q&&(Q=j),void 0===$&&($=j),void 0===ne&&(ne=0),void 0===te&&(te=ne),void 0===ie&&(ie=ne),void 0===oe&&(oe=0),void 0===ce&&(ce=oe),o=ce*Math.PI/180,void 0===ae&&(ae=oe),c=ce*Math.PI/180,void 0===re&&(re=1),void 0===le&&(le=re),void 0===ge&&(ge=re),void 0===de&&(de=0),void 0===ue&&(ue=de),void 0===fe&&(fe=de);let Se,se,ve;if(void 0!==h){let e=h.split(" ");Se=INTEGER(e[0]),se=e[1],ve=e[2]}let he,Re,pe;void 0!==a?(pe=new Image,pe.onload=(()=>{he=pe.width,void 0===f&&(f=he),Re=pe.height,void 0===S&&(S=Re),pe.onload=void 0,t.fireEvent("load")}),pe.src=a):t.fireEvent("load");let Ee,ye,ke=[];t.burst=(n=>{Ee=n,REPEAT(e(x,A),()=>{let n=e(b,_)*Math.PI/180,t=Math.sin(n),i=Math.cos(n),a=e(B,K),l={time:0,lifetime:e(F,N),x:e(P,M),y:e(H,L),scalingSpeed:e(Q,$),direction:n,speedX:a*i,speedY:a*t,scale:e(Z,J),rotationSpeedRadian:e(o,c),radian:e(te,ie)*Math.PI/180,fadingSpeed:e(ue,fe),alpha:e(le,ge)};void 0!==r&&void 0===v&&(l.color="rgb("+RANDOM({min:p,max:E})+", "+RANDOM({min:k,max:m})+", "+RANDOM({min:w,max:Y})+")"),ke.push(l)})});OVERRIDE(t.step,e=>{ye=t.step=(n=>{ke.forEach((e,i)=>{e.time+=n,e.time>e.lifetime?(ke.splice(i,1),void 0!==Ee&&0===ke.length&&Ee(t)):(e.speedX+=G*n,e.speedY+=q*n,e.x+=e.speedX*n,e.y+=e.speedY*n,e.scale+=e.scalingSpeed*n,e.scale<0&&(e.scale=0),e.radian+=e.rotationSpeedRadian*n,e.alpha+=e.fadingSpeed*n,e.alpha<0&&(e.alpha=0))}),e(n)})});let me;OVERRIDE(t.draw,e=>{me=t.draw=(n=>{ke.forEach(e=>{let t=e.scale;if(n.save(),n.translate(e.x,e.y),ee===!0?n.rotate(e.direction):n.rotate(e.radian),n.scale(t,t),n.globalAlpha*=e.alpha,void 0===r)n.drawImage(pe,D-he/2,X-Re/2,he,Re);else{if(n.beginPath(),"line"===r)n.moveTo(D+l,X+g),n.lineTo(D+d,X+u);else if("rect"===r)n.rect(D-f/2,D-S/2,f,S);else if("circle"===r)n.ellipse(D,X,f/2,S/2,0,0,2*Math.PI);else if("polygon"===r&&s.length>0){n.moveTo(D+s[0].x,X+s[0].y);for(let e=1;e<s.length;e+=1){let t=s[e];n.lineTo(D+t.x,X+t.y)}n.lineTo(D+s[0].x,X+s[0].y)}void 0!==v?(n.fillStyle=v,n.fill()):void 0!==e.color&&(n.fillStyle=e.color,n.fill()),void 0!==h&&(n.lineWidth=Se,n.strokeStyle=ve,"dashed"===se?n.setLineDash([5]):"dotted"===se&&n.setLineDash([2]),n.stroke()),n.closePath()}n.restore()}),e(n)})});let Ce;OVERRIDE(t.remove,e=>{Ce=t.remove=(()=>{void 0!==pe&&(pe.onload=void 0,pe=void 0),ke=void 0,e()})})}}}),SkyEngine.ParticleSystemOnce=CLASS({preset:()=>{return SkyEngine.ParticleSystem},init:(e,n,t)=>{n.burst(e=>{e.remove()})}}),SkyEngine.CollisionTile=CLASS({preset:()=>{return SkyEngine.Tile}}),SkyEngine.HexagonTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,t)=>{let i,o=t.overlapHeight;OVERRIDE(n.addTile,t=>{i=n.addTile=(t=>{let i=t.row,c=t.col,a=t.tile,r=t.isCollider,l=n.getCollisionMap(),g=c*n.getTileWidth()+i%2*n.getTileWidth()/2,d=i*(n.getTileHeight()-o);r===!0&&(void 0===l[i]&&(l[i]=[]),l[i][c]=1);let u;u=void 0!==l[i]&&1===l[i][c]?SkyEngine.CollisionTile({x:g,y:d,c:a,collider:SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:-n.getTileHeight()/4},{x:n.getTileWidth()/2,y:n.getTileHeight()/4},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:n.getTileHeight()/4},{x:-n.getTileWidth()/2,y:-n.getTileHeight()/4}]})}):SkyEngine.Tile({x:g,y:d,c:a}),n.append(u),e.addTileNodeToMap({row:i,col:c,tileNode:u})})})}}),SkyEngine.IsometricTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,t)=>{let i;OVERRIDE(n.addTile,t=>{i=n.addTile=(t=>{let i=t.row,o=t.col,c=t.tile,a=t.isCollider,r=n.getCollisionMap(),l=o*n.getTileWidth()+i%2*n.getTileWidth()/2,g=i*n.getTileHeight()/2;a===!0&&(void 0===r[i]&&(r[i]=[]),r[i][o]=1);let d;d=void 0!==r[i]&&1===r[i][o]?SkyEngine.CollisionTile({x:l,y:g,c:c,collider:SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:0},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:0}]})}):SkyEngine.Tile({x:l,y:g,c:c}),n.append(d),e.addTileNodeToMap({row:i,col:o,tileNode:d})})})}}),SkyEngine.Tile=CLASS({preset:()=>{return SkyEngine.Node}}),SkyEngine.TileMap=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i=t.tileWidth,o=t.tileHeight,c=t.tileKeySet,a=t.tileKeyMap,r=t.collisionMap;void 0===c&&(c={}),void 0===a&&(a=[]),void 0===r&&(r=[]);let l,g=[],d=(n.getTileWidth=(()=>{return i}),n.getTileHeight=(()=>{return o}),e.addTileNodeToMap=(e=>{let n=e.row,t=e.col,i=e.tileNode;void 0===g[n]&&(g[n]=[]),g[n][t]=i}));n.addTile=(e=>{let t=e.row,l=e.col,g=e.tile,u=e.isCollider,f=e.key;if(void 0!==f&&void 0!==c[f]&&(g=c[f](),void 0===a[t]&&(a[t]=[]),a[t][l]=f),void 0!==g){u===!0&&(void 0===r[t]&&(r[t]=[]),r[t][l]=1);let e,c=l*i,a=t*o;e=void 0!==r[t]&&1===r[t][l]?SkyEngine.CollisionTile({x:c,y:a,c:g,collider:SkyEngine.Rect({width:i,height:o})}):SkyEngine.Tile({x:c,y:a,c:g}),n.append(e),d({row:t,col:l,tileNode:e})}}),n.getTileKey=(e=>{let n=e.row,t=e.col;if(void 0!==a&&void 0!==a[n])return a[n][t]}),n.getTile=(e=>{let n=e.row,t=e.col;if(void 0!==g[n]&&void 0!==g[n][t])return g[n][t].getChildren()[0]}),n.moveTile=((e,n)=>{let t,c=e.fromRow,l=e.fromCol,u=e.toRow,f=e.toCol,S=e.speed,s=e.accel;void 0===r[u]?r[u]=[]:t=r[u][f],void 0===r[c]?r[c]=[]:r[u][f]=r[c][l],r[c][l]=t,t=void 0,void 0===a[u]?a[u]=[]:t=a[u][f],void 0===a[c]?a[c]=[]:a[u][f]=a[c][l],a[c][l]=t;let v;void 0!==g[c]&&(v=g[c][l]);let h;void 0!==g[u]&&(h=g[u][f]),void 0!==v&&(void 0!==S||void 0!==s?(v.moveTo({x:f*i,y:u*o,speed:S,accel:s},n),n=void 0):v.setPosition({x:f*i,y:u*o})),d({row:u,col:f,tileNode:v}),void 0===h?void 0!==g[c]&&(g[c][l]=void 0):(void 0!==S||void 0!==s?(h.moveTo({x:l*i,y:c*o,speed:S,accel:s},n),n=void 0):h.setPosition({x:l*i,y:c*o}),d({row:c,col:l,tileNode:h}))}),n.removeTile=(e=>{let n=e.row,t=e.col;void 0!==r[n]&&(r[n][t]=void 0),void 0!==a[n]&&(a[n][t]=void 0),void 0!==g[n]&&void 0!==g[n][t]&&(g[n][t].remove(),g[n][t]=void 0)}),n.getCollisionMap=(()=>{return r});OVERRIDE(n.empty,e=>{l=n.empty=(()=>{a=[],r=[],g=[],e()})});n.findPath=(e=>{let n=e.startRow,t=e.startCol,i=e.endRow,o=e.endCol,c=[],a=[],l=(e,n,t)=>{if(void 0!==r[n]&&0===r[n][t]){void 0===c[n]&&(c[n]=[]);let i=e.cost+1;(void 0===c[n][t]||c[n][t]>i)&&(c[n][t]=i,a.push({parent:e,row:n,col:t,cost:i}))}};for(l({cost:-1},n,t);a.length>0;){let e=a.shift();if(e.row===i&&e.col===o){let n=[],t=e;for(;t.cost>=0;)n.unshift({row:t.row,col:t.col}),t=t.parent;return n}l(e,e.row-1,e.col),l(e,e.row,e.col+1),l(e,e.row+1,e.col),l(e,e.row,e.col-1)}})},afterInit:(e,n,t)=>{let i=t.tileMap,o=t.tileKeyMap;void 0!==i&&(EACH(i,(e,t)=>{EACH(e,(e,i)=>{void 0!==e&&n.addTile({row:t,col:i,tile:e})})}),i=void 0),void 0!==o&&EACH(o,(e,t)=>{EACH(e,(e,i)=>{n.addTile({row:t,col:i,key:e})})})}}),SkyEngine("Util").Collision=OBJECT({init:(e,n)=>{let t=(e,n,t)=>{return(n-e)*(t-e)<=0},i=n.checkPointInRect=((e,n,i,o,c,a,r,l,g,d)=>{e-=i,n-=o;let u=i+d*e+g*n,f=o-g*e+d*n;return c*=r,a*=l,i-=c/2,o-=a/2,t(u,i,i+c)===!0&&t(f,o,o+a)===!0}),o=n.checkPointInCircle=((e,n,t,i,o,c,a,r,l,g)=>{e-=t,n-=i,o*=a,c*=r;let d=2*(g*e+l*n)/o,u=2*(l*e-g*n)/c;return d*d+u*u<=1}),c=n.checkPointInPolygon=((e,n,t,i,o,c,a,r,l)=>{e-=t,n-=i;let g=t+l*e+r*n,d=i-r*e+l*n;g-=t,d-=i;let u=!1,f=o.length;for(let S=0,s=f-1;S<f;s=S,S+=1){let e=o[S].x*c,n=o[S].y*a,t=o[s].x*c,i=o[s].y*a;n>d!=i>d&&g<(t-e)*(d-n)/(i-n)+e&&(u=!u)}return u}),a=n.checkLineLine=((e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,v,h,R,p,E)=>{t*=a,i*=r;let y=e+g*t+l*i,k=n+l*t+g*i;o*=a,c*=r;let m=e+g*o+l*c,C=n+l*o+g*c;f*=h,S*=R;let w=d+E*f+p*S,Y=u+p*f+E*S;s*=h,v*=R;let D=d+E*s+p*v,X=u+p*s+E*v,I=(m-y)*(X-Y)-(D-w)*(C-k);if(0===I)return!1;{let e=((X-Y)*(D-y)+(w-D)*(X-k))/I,n=((k-C)*(D-y)+(m-y)*(X-k))/I;return 0<=e&&e<=1&&0<=n&&n<=1}}),r=(n.checkLineRect=((e,n,t,o,c,r,l,g,d,u,f,S,s,v,h,R,p,E)=>{t*=l,o*=g;let y=e+u*t+d*o,k=n+d*t+u*o;if(i(y,k,f,S,s,v,h,R,p,E)===!0)return!0;c*=l,r*=g;let m=e+u*c+d*r,C=n+d*c+u*r;if(i(m,C,f,S,s,v,h,R,p,E)===!0)return!0;let w,Y,D,X,I,x,A,T;s*=h/2,v*=R/2;let P=E*s,M=E*v,O=-p*s,H=-p*v;return w=f-P-H,Y=S+O-M,D=f+P-H,X=S-O-M,I=f+P+H,x=S-O+M,A=f-P+H,T=S+O+M,a(0,0,y,k,m,C,1,1,0,1,0,0,w,Y,D,X,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,D,X,I,x,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,I,x,A,T,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,A,T,w,Y,1,1,0,1)===!0}),n.checkLineCircle=((e,n,i,c,a,l,g,d,u,f,S,s,v,h,R,p,E,y)=>{i*=g,c*=d;let k=e+f*i+u*c,m=n+u*i+f*c;if(o(k,m,S,s,v,h,R,p,E,y)===!0)return!0;a*=g,l*=d;let C=e+f*a+u*l,w=n+u*a+f*l;if(o(C,w,S,s,v,h,R,p,E,y)===!0)return!0;k-=S,m-=s,C-=S,w-=s;let Y=y*k+E*m,D=-E*k+y*m,X=y*C+E*w,I=-E*C+y*w;v*=R,h*=p;let x=(I-D)/(X-Y);if(Math.abs(x)>1024)return r(0,0,D,Y,I,X,1,1,0,1,0,0,h,v,1,1,0,1);if(o(X,I,0,0,v,h,1,1,0,1)===!0)return!0;let A=v*v/4,T=h*h/4,P=D-x*Y,M=1/A+x*x/T,O=2*x*P/T,H=P*P/T-1,L=O*O-4*M*H;return!(L<0)&&(L=Math.sqrt(L),M*=2,t((-O-L)/M,Y,X)===!0||t((-O+L)/M,Y,X)===!0)})),l=(n.checkLinePolygon=((e,n,t,i,o,r,l,g,d,u,f,S,s,v,h,R,p)=>{t*=l,i*=g;let E=e+u*t+d*i,y=n+d*t+u*i;if(c(E,y,f,S,s,v,h,R,p)===!0)return!0;o*=l,r*=g;let k=e+u*o+d*r,m=n+d*o+u*r;if(c(k,m,f,S,s,v,h,R,p)===!0)return!0;let C=s.length;for(let w=0,Y=C-1;w<C;Y=w,w+=1){let e=s[w].x*v,n=s[w].y*h,t=s[Y].x*v,i=s[Y].y*h,o=f+p*e-R*n,c=S+R*e+p*n,r=f+p*t-R*i,l=S+R*t+p*i;if(a(0,0,E,y,k,m,1,1,0,1,0,0,o,c,r,l,1,1,0,1)===!0)return!0}return!1}),n.checkRectRect=((e,n,t,o,c,r,l,g,d,u,f,S,s,v,h,R)=>{t*=c,o*=r,f*=s,S*=v;let p,E,y,k,m,C,w,Y,D=g*t/2,X=g*o/2,I=-l*t/2,x=-l*o/2;if(p=e-D-x,E=n+I-X,y=e+D-x,k=n-I-X,m=e+D+x,C=n-I+X,w=e-D+x,Y=n+I+X,i(p,E,d,u,f,S,1,1,h,R)===!0||i(y,k,d,u,f,S,1,1,h,R)===!0||i(m,C,d,u,f,S,1,1,h,R)===!0||i(w,Y,d,u,f,S,1,1,h,R)===!0)return!0;let A,T,P,M,O,H,L,V,F=R*f/2,N=R*S/2,W=-h*f/2,b=-h*S/2;return A=d-F-b,T=u+W-N,P=d+F-b,M=u-W-N,O=d+F+b,H=u-W+N,L=d-F+b,V=u+W+N,i(A,T,e,n,t,o,1,1,l,g)===!0||i(P,M,e,n,t,o,1,1,l,g)===!0||i(O,H,e,n,t,o,1,1,l,g)===!0||i(L,V,e,n,t,o,1,1,l,g)===!0||(a(0,0,p,E,y,k,1,1,0,1,0,0,A,T,P,M,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,P,M,O,H,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,O,H,L,V,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,L,V,A,T,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,A,T,P,M,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,P,M,O,H,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,O,H,L,V,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,L,V,A,T,1,1,0,1)===!0||a(0,0,m,C,w,Y,1,1,0,1,0,0,A,T,P,M,1,1,0,1)===!0||a(0,0,m,C,w,Y,1,1,0,1,0,0,P,M,O,H,1,1,0,1)===!0||a(0,0,m,C,w,Y,1,1,0,1,0,0,O,H,L,V,1,1,0,1)===!0||a(0,0,m,C,w,Y,1,1,0,1,0,0,L,V,A,T,1,1,0,1)===!0||a(0,0,w,Y,p,E,1,1,0,1,0,0,A,T,P,M,1,1,0,1)===!0||a(0,0,w,Y,p,E,1,1,0,1,0,0,P,M,O,H,1,1,0,1)===!0||a(0,0,w,Y,p,E,1,1,0,1,0,0,O,H,L,V,1,1,0,1)===!0||a(0,0,w,Y,p,E,1,1,0,1,0,0,L,V,A,T,1,1,0,1)===!0)}),n.checkRectCircle=((e,n,t,c,a,l,g,d,u,f,S,s,v,h,R,p)=>{if(i(u,f,e,n,t,c,a,l,g,d)===!0)return!0;let E,y,k,m,C,w,Y,D;t*=a/2,c*=l/2;let X=d*t,I=d*c,x=-g*t,A=-g*c;return E=e-X-A,y=n+x-I,k=e+X-A,m=n-x-I,C=e+X+A,w=n-x+I,Y=e-X+A,D=n+x+I,o(E,y,u,f,S,s,v,h,R,p)===!0||o(k,m,u,f,S,s,v,h,R,p)===!0||o(C,w,u,f,S,s,v,h,R,p)===!0||o(Y,D,u,f,S,s,v,h,R,p)===!0||(S*=v,s*=h,r(0,0,E,y,k,m,1,1,0,1,u,f,S,s,1,1,R,p)===!0||r(0,0,k,m,C,w,1,1,0,1,u,f,S,s,1,1,R,p)===!0||r(0,0,C,w,Y,D,1,1,0,1,u,f,S,s,1,1,R,p)===!0||r(0,0,Y,D,E,y,1,1,0,1,u,f,S,s,1,1,R,p)===!0)}),n.checkRectPolygon=((e,n,t,o,r,l,g,d,u,f,S,s,v,h,R)=>{t*=r,o*=l;let p,E,y,k,m,C,w,Y,D=d*t/2,X=d*o/2,I=-g*t/2,x=-g*o/2;if(p=e-D-x,E=n+I-X,y=e+D-x,k=n-I-X,m=e+D+x,C=n-I+X,w=e-D+x,Y=n+I+X,c(p,E,u,f,S,s,v,h,R)===!0||c(y,k,u,f,S,s,v,h,R)===!0||c(m,C,u,f,S,s,v,h,R)===!0||c(w,Y,u,f,S,s,v,h,R)===!0)return!0;let A=S.length;for(let T=0,P=A-1;T<A;P=T,T+=1){let c=S[T].x*s,r=S[T].y*v,l=u+R*c-h*r,D=f+h*c+R*r;if(i(l,D,e,n,t,o,1,1,g,d)===!0)return!0;let X=S[P].x*s,I=S[P].y*v,x=u+R*X-h*I,A=f+h*X+R*I;if(a(0,0,p,E,y,k,1,1,0,1,0,0,l,D,x,A,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,l,D,x,A,1,1,0,1)===!0||a(0,0,m,C,w,Y,1,1,0,1,0,0,l,D,x,A,1,1,0,1)===!0||a(0,0,w,Y,p,E,1,1,0,1,0,0,l,D,x,A,1,1,0,1)===!0)return!0}return!1}),(e,n,t,i,o)=>{if(0===o)return!0;if(0===e)return 0!==n||(0!==t?i*i-4*t*o>=0:0!==i);let c=n/e,a=t/e,r=i/e,l=o/e,g=(8*a-3*c*c)/8,d=(c*c*c-4*c*a+8*r)/8,u=(-3*c*c*c*c+256*l-64*r*c+16*c*c*a)/256,f=256*u*u*u-128*g*g*u*u+144*g*d*d*u-27*d*d*d*d+16*g*g*g*g*u-4*g*g*g*d*d,S=8*g,s=64*u-16*g*g;return f<0||f>0&&S<0&&s<0||0===f&&(0!==s||S<=0)}),g=(e,n,t,i,o,c,a,r,g,d,u,f)=>{let S=(r/=a)-(n/=e),s=(g/=a)-(t/=e),v=(d/=a)-(i/=e),h=(u/=a)-(o/=e),R=(f/=a)-(c/=e);if(0===S&&0===v)return l(0,0,s,h,R);let p=n*g-r*t,E=n*u+i*g-r*o-d*t,y=n*f+i*u-r*c-d*o,k=i*f-d*c,m=s*s-p*S,C=2*s*h-S*E-v*p,w=h*h+2*s*R-S*y-v*E,Y=2*h*R-v*y-S*k,D=R*R-v*k;return l(m,C,w,Y,D)};n.checkCircleCircle=((e,n,t,i,c,a,r,l,d,u,f,S,s,v,h,R)=>{t*=c,i*=a,f*=s,S*=v,d-=e,u-=n,e=n=0;let p=((t>i?t:i)+(f>S?f:S))/2;if(d*d+u*u>p*p)return!1;if(o(d,u,e,n,t,i,1,1,r,l)===!0||o(e,n,d,u,f,S,1,1,h,R)===!0)return!0;let E=l*e+r*n,y=-r*e+l*n;r=-r;let k=t*t/4,m=i*i/4,C=l*l/k+r*r/m,w=-2*l*r/k+2*l*r/m,Y=r*r/k+l*l/m,D=-2*E*l/k-2*y*r/m,X=2*E*r/k-2*y*l/m,I=E*E/k+y*y/m-1;E=R*d+h*u,y=-h*d+R*u,h=-h,k=f*f/4,m=S*S/4;let x=R*R/k+h*h/m,A=-2*R*h/k+2*R*h/m,T=h*h/k+R*R/m,P=-2*E*R/k-2*y*h/m,M=2*E*h/k-2*y*R/m,O=E*E/k+y*y/m-1;return g(C,w,Y,D,X,I,x,A,T,P,M,O)&&g(Y,w,C,X,D,I,T,A,x,M,P,O)}),n.checkCirclePolygon=((e,n,t,i,a,l,g,d,u,f,S,s,v,h,R)=>{if(c(e,n,u,f,S,s,v,h,R)===!0)return!0;t*=a,i*=l;let p=S.length;for(let E=0,y=p-1;E<p;y=E,E+=1){let c=S[E].x*s,a=S[E].y*v,l=u+R*c-h*a,p=f+h*c+R*a;if(o(l,p,e,n,t,i,1,1,g,d)===!0)return!0;let k=S[y].x*s,m=S[y].y*v,C=u+R*k-h*m,w=f+h*k+R*m;if(r(0,0,l,p,C,w,1,1,0,1,e,n,t,i,1,1,g,d)===!0)return!0}return!1}),n.checkPolygonPolygon=((e,n,t,i,o,r,l,g,d,u,f,S,s,v)=>{let h=t.length,R=u.length;for(let p=0,E=R-1;p<R;E=p,p+=1){let a=u[p].x*f,h=u[p].y*S,R=g+v*a-s*h,E=d+s*a+v*h;if(c(R,E,e,n,t,i,o,r,l)===!0)return!0}for(let p=0,E=h-1;p<h;E=p,p+=1){let h=t[p].x*i,y=t[p].y*o,k=e+l*h-r*y,m=n+r*h+l*y;if(c(k,m,g,d,u,f,S,s,v)===!0)return!0;let C=t[E].x*i,w=t[E].y*o,Y=e+l*C-r*w,D=n+r*C+l*w;for(let X=0,I=R-1;X<R;I=X,X+=1){let e=u[X].x*f,n=u[X].y*S,t=g+v*e-s*n,i=d+s*e+v*n,o=u[I].x*f,c=u[I].y*S,r=g+v*o-s*c,l=d+s*o+v*c;if(a(0,0,k,m,Y,D,1,1,0,1,0,0,t,i,r,l,1,1,0,1)===!0)return!0}}return!1})}}),SkyEngine("Util").ImageData=OBJECT({init:(e,n)=>{const t=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1],i=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0];let o=n.checkImageDataPointIsTransparent=((e,n,t,i)=>{return e[4*(i*n+t)+3]<=20});n.convertImageDataToPolygon=((e,n)=>{let c,a,r,l,g=0,d=0,u=[];for(;;){if(o(e,n,g,d)!==!0){r=g,l=d;break}0===g?(g=d+1,d=0):(g-=1,d+=1)}g=r,d=l;let f=0,S=0;do{let r=0;if(o(e,n,g-1,d-1)!==!0&&(r+=1),o(e,n,g,d-1)!==!0&&(r+=2),o(e,n,g-1,d)!==!0&&(r+=4),o(e,n,g,d)!==!0&&(r+=8),6===r)f=a===-1?-1:1,S=0;else if(9===r)f=0,S=1===c?-1:1;else{if(!(r<15))break;f=t[r],S=i[r]}if(f!==c&&S!==a&&(u.push({x:g,y:d}),c=f,a=S),g+=f,d+=S,g<0||d<0)break}while(r!==g||l!==d);return u})}});